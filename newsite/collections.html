<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Mireia Artigas</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="styles/normalize.min.css">
        <link rel="stylesheet" href="styles/main.css">
        <!--<script src="scripts/lib/modernizr-2.6.1-respond-1.1.0.min.js"></script>-->
    </head>
    <body class="collections">
        <!--[if lte IE 7]>
            <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
        <![endif]-->
        
        <div class="content">
           <!-- <div class="collage">
                <img src="images/mainfotos/col1.1.jpg"/>
            </div>
            
            <div class="collage">
                <img src="images/mainfotos/col2.1.jpg"/>
            </div>
            
            <div class="collage">
                <img src="images/mainfotos/col3.1.jpg"/>
            </div>
            
            <div class="collage">
                <img src="images/mainfotos/col4.1.jpg"/>
            </div>
            
            <div class="collage">
                <img src="images/mainfotos/col5.1.jpg"/>
            </div>
            
            <div class="collage">
                <img src="images/mainfotos/col6.1.jpg"/>
            </div> 
            
            <div class="collage">
                <img src="images/mainfotos/col7.1.jpg"/>
            </div>
            
            <div class="collage">
                <img src="images/mainfotos/col8.1.jpg"/>
            </div>
            
            <div class="collage">
                <img src="images/mainfotos/unik1.jpg"/>
            </div>            
            
            <div class="collage">
                <img src="images/mainfotos/unik2.jpg"/>
            </div>
            
            <div class="collage">
                <img src="images/mainfotos/unik3.jpg"/>
            </div>-->
            <div id="canvas-markup" style="z-index:-1;position:absolute;background-color:hsla(120,100%,75%,0.3);left:30%;"></div>
        </div>
        
        <aside>
            <img src="images/decorations/logo2.png" class="logo" alt="Mireia Artigas"/>
            <nav>
                <ul>
                    <li class="current-menu-item"><a href="collections.html">Collections</a></li>
                    <li><a href="about.html">About us</a></li>
                    <li><a href="#">The family</a></li>
                    <li><a href="#">Contact us</a></li>
                </ul>
            </nav>
            <footer>&reg;2012 Mireia Artigas</footer>
        </aside>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="scripts/lib/jquery-1.8.2.min.js"><\/script>')</script>
        <script src="scripts/style.js"></script>
        <script src="scripts/lib/jquery.masonry.min.js"></script>
        <script>
            /** TODO: put this on some server*/
            function meta(conf) {
                this.src = conf.src;
                this.width = conf.width;
                this.height = conf.height;
            }
            /*
            function getImageMeta() {
                var metaData = [];
                $('.content img').each(function(i, el) {
                    metaData.push(new meta({ src: el.src.replace(/^.+(?=images\/)/, ''), width: el.naturalWidth, height: el.naturalHeight }));
                });
                return metaData;
            }
            console.log(
                JSON.stringify(
                    getImageMeta()
                )
            );*/
            var ns = ns || {};  // namespace
            ns.imagesMeta = [{"src":"images/mainfotos/col1.1.jpg","width":1701,"height":1134},{"src":"images/mainfotos/col2.1.jpg","width":1701,"height":1134},{"src":"images/mainfotos/col3.1.jpg","width":1626,"height":1125},{"src":"images/mainfotos/col4.1.jpg","width":850,"height":1276},{"src":"images/mainfotos/unik2.jpg","width":831,"height":1247},{"src":"images/mainfotos/col5.1.jpg","width":1582,"height":1134},{"src":"images/mainfotos/col6.1.jpg","width":1701,"height":1134},{"src":"images/mainfotos/col7.1.jpg","width":1304,"height":1134},{"src":"images/mainfotos/col8.1.jpg","width":1701,"height":978},{"src":"images/mainfotos/unik1.jpg","width":1469,"height":1128},{"src":"images/mainfotos/unik3.jpg","width":1701,"height":1134}];

            ns.sum = function(a,b){ return a+b; };
            ns.imageArea = function(img1, img2) {
                return (Array.isArray(img1) ? img1.reduce(ns.sum) : img1) + img2.reduce(ns.sum);
            }
            ns.resizeToCanvas = function(img, i , all) {
                all[i][0] = Math.round(img[0] * this.factor);
                all[i][1] = Math.round(img[1] * this.factor);
            }
            ns.placeImage = function(img, i, all) {
                //TODO: implement genetic algorithme for best fit, e.g. randomize image order and calc cost

            }
            ns.createImages = function(images, urls) {
                images.forEach(function insertImage(img, i, all) {
                    /*
                    $('<img style="right:' + (i > 0 ? all[i-1][0] : 0) + 'px;" src="' + urls[i] + '" width="' + img[0] + 'px" height="' + img[1] + 'px"/>')*/
                    $('<img src="' + urls[i] + '" width="' + img[0] + '" height="' + img[1] + '"/>')
                        .appendTo(ns.canvas.scene);
                });                
            }
            ns.Canvas = function() {
                this.factor = 0.0;
                //this.currentSlot = 0;   // not used
                this.scene = $('.content');
                //this.area = [[0, 0, this.scene.width(), $(window).height(), 0]]; /* 0 === false */
                this.area = [this.scene.width(), $(window).height()];
            };
            ns.canvas = new ns.Canvas();
            // create all the image placeholders and an url-table
            ns.urlTable = new Array(ns.imagesMeta.length);
            /**
             * [width, height, urlTableId]
             */
            ns.imageRectangles = ns.imagesMeta.map(function(el, i) {
                var margin = 3;
                ns.urlTable[i] = el.src;    // update the urlTable
                return [el.width + margin, el.height + margin, i];
            });
            console.log("canvas width: ", ns.canvas.scene.width(), "canvas height: ", $(window).height());
            $('#canvas-markup').css({ height:$(window).height(), width:ns.canvas.scene.width()});
            // calculate how much space the images needs
            ns.canvas.factor =  ns.canvas.area.reduce(ns.sum) /
                                ns.imageRectangles.reduce(ns.imageArea);
                                

console.log("images = " + ns.imageRectangles.reduce(ns.imageArea) + "px2");

            // resize the images to fit in the canvas
            ns.imageRectangles.forEach(ns.resizeToCanvas, ns.canvas);
            // place images in canvas TODO: only applicable when the genetic algorithme is implemented
            //ns.imageRectangles.forEach(ns.placeImage, ns.canvas);
            ns.createImages(ns.imageRectangles, ns.urlTable);
     /*       ns.canvas.scene.masonry({
                // options
                itemSelector : 'img'
            });*/
            //console.dir(ns.canvas);
            //console.dir(ns.imageRectangles);
            //console.dir(ns.urlTable);
            console.log(
                "factor = " + ns.canvas.factor,
                "canvas = " + ns.canvas.area.reduce(ns.sum) + "px2",
                "images = " + ns.imageRectangles.reduce(ns.imageArea) + "px2"
            );
            console.log("canvas width: ", ns.canvas.scene.width(), "canvas height: ", $(window).height());
            console.dir(ns.imageRectangles);
        </script>
        
        <!-- <script src="scripts/lib/jquery.isotope.min.js"></script> -->
        
          
    </body>
</html>
